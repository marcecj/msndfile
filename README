The msndfile Mex extension
==========================
Marc Joliet <marc.joliet@stud.fh-oldenburg.de>

Introduction
------------

This document explains how to compile msndfile.

msndfile is a mex wrapper for the libsndfile C library for reading audio files.
It returns the audio files as MxN arrays, M being the number of samples per
channel and N being the number of channels, as returned by, e.g., 'wavread()'.
The only thing it doesn't do is write audio files, which should be relatively
simple, though.

Compiling
---------

There are 2 ways to compile msndfile.  The easy way is to call the m-file
'compile_msndfile.m' from Matlab.  There is also a more flexible build system
based on SCons available, though it is perhaps overblown for a project of this
size.  It has, however, proven that a proper and robust cross-platform build
system for Mex extensions is possible.  There is also an obsolete CMake based
build system, which is probably broken, as fixes to compilation errors were
incorporated in the SConstruct file but not in the CMakeLists.txt file.  For
details to all methods, see their relevant subsections.

A problem of all methods of compilation is that at least two things are not
implemented.  For one thing: installing.  It is expected that you copy the
resulting Mex binaries to wherever your Matlab installation looks for them.  The
other problem is that on Windows with CMake, required DLLs are not copied into
the Visual Studio build directory (though it is of course possible and probably
easy).  This means you have to add an appropriate command to the VS project file
or copy the DLLs yourself.

Prerequisites
~~~~~~~~~~~~~

Linux
^^^^^

You need to have the libsndfile development package installed (typically a
package with a '-devel' suffix).  On systems like Gentoo, where runtime and
development components are not separated, simply install the libsndfile package.

Windows
^^^^^^^

You don't need anything.  All needed libraries and Headers (except those
belonging to Matlab) are bundled.

Mac OS X
^^^^^^^^

You need to install libsndfile.  To do so, follow the instructions at
http://www.mega-nerd.com/libsndfile[]).  If there is no binary available for your
version of OS X, use a package management system like fink or (better, in the
opinion of the author) macports.

Using the compile_msndfile.m script (all platforms)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

In Matlab, type 'compile_msndfile'.  This will compile both Mex extensions
and run a test script.

Using the SCons based build system
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The SCons based build system is a more robust alternative to the CMake based
one.  It comes with an extension that properly presets a few environment
variables, though it slows compilation down because it starts a Matlab
subprocess to obtain them.  If you need to work on the Code and plan to compile
often, you can use the interactive mode by passing the '--interactive' option to
SCons, so that the command line would look like

--------------------------------------
scons --interactive [options] [target]
--------------------------------------

Linux
^^^^^

Just open a terminal and type

-----------------
    $ scons
-----------------

while in the source directory.  Users with 32 bit Matlab on 64 bit systems
should pass the --linux32 option to enforce 32 bit compilation.

Windows
^^^^^^^

If SCons is in your PATH, you can open a console and follow the steps under
Linux.  The '--make-msvs' option creates a MS VisualStudio Solution file with
mmsndfile as a project.  For other IDEs, see
http://www.scons.org/wiki/IDEIntegration[].

Mac OS X
^^^^^^^^

Follow the same steps as under Linux, or look into integrating SCons into your
IDE of choice (see http://www.scons.org/wiki/IDEIntegration[]).

Using the CMake based build system (obsolete)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The CMake based build system is obsoleted by both the SCons based build system
and the 'compile_msndfile.m' script.  It is documented here for completeness.

Linux
^^^^^

Just open a terminal and type

-----------------
    $ cmake .
-----------------

while in the source directory.  This will produce a Makefile that works as
expected, save for the aforementioned caveats.  Alternatively, you can use the
'cmake-gui' application (see the Windows subsection for a small introduction).

Windows
^^^^^^^

Under Windows it is recommended to use the 'cmake-gui' application. Follow these steps:

    1. Select the source and build directories (typically identical).
    2. Click on 'Configure' to configure the build system.  Upon first use, you
       will be prompted for the target, i.e. which IDE/compiler you use.
    3. Click on 'Generate'.  This will, as the name implies, generates a project
       file for your IDE of choice.

You should now have an IDE project file in the source directory.  Open it and
start compilation.

Mac OS X
^^^^^^^^

On Mac OS X you can either follow the same steps as under Linux or under
Windows according to your own preferences.

Copyrights
----------

//////////////////////////////////////////////////////////////////////////////
NOTE: if this is ever distributed publicly, the source code to libsndfile must
also be distributed.
//////////////////////////////////////////////////////////////////////////////
For the copyrights to msndfile, see the file LICENSE.

The test files test.{raw,flac,wav} are an excerpt of "Glass Cafe" by Jon7 and
are licensed under the "Attribution-NonCommercial-ShareAlike 2.5 Generic (CC
BY-NC-SA 2.5)" license (see
http://creativecommons.org/licenses/by-nc-sa/2.5/[]).

libsndfile is maintained by Erik de Castro Lopo <erikd@mega-nerd.com> and is
licensed under the LGPLv2.1 (included in the source directory, see the file
``LGPL-2.1'').
